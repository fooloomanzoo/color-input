<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, minimum-scale=1, initial-scale=1, user-scalable=yes">

  <title>color-badge test</title>

  <script src="../../webcomponentsjs/webcomponents-lite.js"></script>
  <script src="../../web-component-tester/browser.js"></script>
  <script src="../../input-picker-pattern/utils/wct-mixin-test-helper.js"></script>

  <link rel="import" href="../color-badge.html">
</head>

<body>

  <test-fixture id="Basic">
    <template>
      <color-badge></color-badge>
    </template>
  </test-fixture>

  <test-fixture id="ChangingProperties">
    <template>
      <color-badge color-string="#123"></color-badge>
    </template>
  </test-fixture>

  <script>
    WCT.helpers.mixinSuite('color-badge');

    suite('basic', function() {

      let element;

      setup(function() {
        element = fixture('Basic');
      });

      test('instantiating the element with default properties should work', done => {
        assert.isUndefined(element.hideTransparencyPattern, 'no hideTransparencyPattern is defined');
        assert.isDefined(element._badgewidth, '_badgewidth is defined');
        assert.isDefined(element._badgeheight, '_badgeheight is defined');
        assert.isDefined(element._badgecontext, '_badgecontext is defined');
        assert.isDefined(element.timeSeparator, 'timeSeparator is defined');
        assert.isDefined(element.amString, 'amString is defined');
        assert.isDefined(element.pmString, 'pmString is defined');
        assert.isDefined(element.dateOrder, 'dateOrder is defined');
        assert.isDefined(element.propertyForValue, 'propertyForValue is defined');
        done();
      });

      test('calling "now" on the element should work', done => {
        assert.isDefined(element.now, '"now" exists');
        element.now();
        assert.isDefined(element.date, 'date is defined');
        assert.isDefined(element.time, 'time is defined');
        assert.isDefined(element.datetime, 'datetime is defined');
        assert.isDefined(element.value, 'value is defined');
        assert.isDefined(element.valueAsNumber, 'valueAsNumber is defined');
        assert.isDefined(element.valueAsDate, 'valueAsDate is defined');
        assert.isDefined(element.year, 'year is defined');
        assert.isDefined(element.month, 'month is defined');
        assert.isDefined(element.day, 'day is defined');
        assert.isDefined(element.hour, 'hour is defined');
        assert.isDefined(element.minute, 'minute is defined');
        assert.isDefined(element.second, 'second is defined');
        assert.isDefined(element.millisecond, 'millisecond is defined');
        assert.isDefined(element.timezone, 'timezone is defined');
        assert.isDefined(element.offsetMinutes, 'timezone-offset is defined');
        assert.isDefined(element._timeZoneHours, 'timezone-hours is defined');
        assert.isDefined(element._timeZoneMinutes, 'timezone-minutes is defined');
        done();
      });
    });

    suite('setting properties', () => {
      let element;

      setup(function() {
        element = fixture('ChangingProperties');
      });

      test('setting property should work', done => {
        assert.equal(element.year, 1980, 'year should be set');
        assert.equal(element.month, 2, 'month should be set');
        assert.equal(element.day, 1, 'day should be set');
        assert.equal(element.hour, 0, 'hour should be set');
        assert.equal(element.minute, 0, 'minute should be set');
        assert.equal(element.second, 0, 'second should be set');
        assert.equal(element.millisecond, 0, 'millisecond should be set');
        assert.equal(element.date, '1980-02-01', 'date should be set');
        assert.equal(element.time, '00:00:00.000', 'time should be set');
        assert.isDefined(element.valueAsNumber, 'valueAsNumber should be set');
        assert.isDefined(element.valueAsDate, 'valueAsDate should be set');
        assert.isDefined(element.timezone, 'timezone should be set');
        assert.isDefined(element.offsetMinutes, 'offsetMinutes should be set');
        done();
      });
    });

    suite('clamp and hidden inputs', function() {
      let f;

      setup(function() {
        f = fixture('Clamp');
      });

      test('clamp month', done => {
        let element = f.querySelector('#clamp-month');

        setTimeout(() => {
          // wait a tick to let dom-if stamping finish
          assert.equal(element.clamp, 'month', 'clamp is set');

          let yearInput = element.shadowRoot.querySelector('#year');
          let monthInput = element.shadowRoot.querySelector('#month');
          let dayInput = element.shadowRoot.querySelector('#day');

          assert.notEqual(document.defaultView.getComputedStyle(yearInput).display, 'none', 'year is not hidden');
          if (monthInput) {
            assert.equal(document.defaultView.getComputedStyle(monthInput).display, 'none', 'month is hidden');
          }
          if (dayInput) {
            assert.equal(document.defaultView.getComputedStyle(dayInput).display, 'none', 'day is hidden');
          }
          done();
        }, 0);
      });

      test('clamp day', done => {
        let element = f.querySelector('#clamp-day');
        setTimeout(() => {
          // wait a tick to let dom-if stamping finish
          let yearInput = element.shadowRoot.querySelector('#year');
          let monthInput = element.shadowRoot.querySelector('#month');
          let dayInput = element.shadowRoot.querySelector('#day');

          assert.notEqual(document.defaultView.getComputedStyle(yearInput).display, 'none', 'year is not hidden');
          assert.notEqual(document.defaultView.getComputedStyle(monthInput).display, 'none', 'month is not hidden');

          if (dayInput) {
            assert.equal(document.defaultView.getComputedStyle(dayInput).display, 'none', 'day is hidden');
          }
          done();
        }, 0);
      });

      test('no clamp', done => {
        let element = f.querySelector('#clamp-none');
        setTimeout(() => {
          // wait a tick to let dom-if stamping finish
          let yearInput = element.shadowRoot.querySelector('#year');
          let monthInput = element.shadowRoot.querySelector('#month');
          let dayInput = element.shadowRoot.querySelector('#day');

          assert.notEqual(document.defaultView.getComputedStyle(yearInput).display, 'none', 'year is not hidden');
          assert.notEqual(document.defaultView.getComputedStyle(monthInput).display, 'none', 'month is not hidden');
          assert.notEqual(document.defaultView.getComputedStyle(dayInput).display, 'none', 'day is not hidden');

          done();
        }, 0);
      });
    });
  </script>

</body>

</html>
