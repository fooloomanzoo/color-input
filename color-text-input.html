<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../text-input/text-input.html">
<link rel="import" href="../input-picker-pattern/form-element-mixin.html">
<link rel="import" href="color-badge.html">

<script>
  /**
   * Mixin for color-text-input
   *
   * @appliesMixin ColorBadgePattern
   * @appliesMixin FormElementMixin
   *
   * @mixinFunction
   * @polymer
   */
  const ColorTextInputPattern = (superClass) => class extends ColorBadgePattern(FormElementMixin(superClass)) { // eslint-disable-line no-unused-vars, no-undef

    static get template() {
      return `
        ${this.styleTemplate}
        ${this.colorInputTemplate}
      `
    }

    static get styleTemplate() {
      return `
        <style include="${this.customStyleToInclude}">
          ${this.customStyleContent}
        </style>
      `;
    }

    static get customStyleToInclude() {
      return '';
    }

    static get customStyleContent() {
      return `
        ${super.customStyleContent || ''}
        :host {
          vertical-align: middle;
          --color-badge-border-radius: 3px;
          --input-style: {
            border-color: rgba(0,0,0,0.1);
            border-width: thin;
            border-style: dotted;
            outline: none;
            transition: background-color 250ms ease-in-out;
          };
          --input-focus: {
            border-color: rgba(0,0,0,0.25);
            border-bottom-style: solid;
            background: rgba(0,0,0,0.1);
          };
          --input-invalid: {
            background: rgba(255,0,0,0.25);
            border-color: rgba(255,0,0,0.5);
          };
          --input-selection-background: rgba(0,0,0,0.1);
        }
        #colorInput {
          display: inline-flex;
          flex-direction: row;
          align-items: center;
        }
        #colorBadge {
          position: relative;
        }
        text-input {
          margin-left: 0.4em;
          align-self: stretch;
        }
      `;
    }

    static get colorInputTemplate() {
      return `
        <div id="colorInput">
          ${super.colorBadgeTemplate || ''}
          <text-input class="input" required="[[required]]" default="{{default}}" value="{{value}}" pattern="[[_computeFormatPattern(format)]]" placeholder="#000" minlength="7"></text-input>
        </div>
      `
    }

    static get colorBadgeSlotTemplate() {
      return '';
    }

    static get properties() {
      return {
        /**
         * width of the badge in pixels
         * @type {number}
         */
        width: {
          type: Number,
          value: 28
        },
        /**
         * height of the badge in pixels
         * @type {number}
         */
        height: {
          type: Number,
          value: 24
        },
        /**
         * default value of the input
         * @type {number}
         */
        default: {
          type: String
        }
      }
    }

    validate() {
      this._setValue();
      return super.validate();
    }

    _computeFormatPattern(format) {
      switch (format) {
        case 'hsl':
          return this._validateHsl.toString().slice(1,-1);
        default:
          return '^(?:' + this._validateRgb.toString().slice(2,-2) + '|' + this._validateHex.toString().slice(2,-2) + ')$';
      }
    }

  }
</script>

<dom-module id="color-text-input">
  <script>
  /**
  * `<color-text-input>` adds a color input to your page using Polymer.
  *
  *   ```html
  *     <color-text-input value="{{color}}"></color-text-input>
  *   ```
  *
  *
  * The following custom properties and mixins are also available for styling:
  *
  * Custom property | Description | Default
  * ----------------|-------------|----------
  * Custom property | Description | Default
  * ----------------|-------------|----------
  * `--transparency-pattern` | background pattern for the transparency layer | { background-image: linear-gradient(45deg, #000 25%, transparent 25%, transparent 75%, #000 75%, #000), linear-gradient(45deg, #000 25%, transparent 25%, transparent 75%, #000 75%, #000); background-size: 16px 16px; background-position:0 0, 8px 8px; opacity: .1; }
  * `--color-badge-border-radius` | border-radius of the badge | 4px
  *
  * @customElement
  * @polymer
  *
  * @appliesMixin ColorTextInputPattern
  *
  * @demo demo/input.html
  * @demo demo/form.html in a form
  **/
    class ColorTextInput extends ColorTextInputPattern(Polymer.Element) { // eslint-disable-line no-undef

      static get is() {
        return 'color-text-input';
      }

    }
    window.customElements.define(ColorTextInput.is, ColorTextInput);
  </script>
</dom-module>
