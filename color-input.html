<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../number-input/number-input.html">
<link rel="import" href="../number-input/integer-input.html">
<link rel="import" href="../text-input/text-input.html">
<link rel="import" href="color-text-input.html">

<script>
  /**
   * Mixin for color-input
   *
   * @appliesMixin ColorTextInputPattern
   *
   * @mixinFunction
   * @polymer
   */
  const ColorInputPattern = (superClass) => class extends ColorTextInputPattern(superClass) { // eslint-disable-line no-unused-vars, no-undef

    static get customStyleContent() {
      return `
        ${super.customStyleContent || ''}
        number-input,
        integer-input {
          align-self: stretch;
        }
        label {
          margin-left: 0.4em;
        }
        number-input,
        integer-input {
          margin-left: 0.2em;
        }
      `;
    }

    static get colorInputTemplate() {
      return `
        <div id="colorInput">
          ${super.colorBadgeTemplate || ''}
          <template is="dom-if" if="[[_equals(format, 'hex')]]" restamp>
            <text-input id="valueInput" required="[[required]]" default="{{default}}" value="{{value}}" pattern="[[_hexPatternString]]" placeholder="#000" minlength="7"></text-input>
          </template>
          <template is="dom-if" if="[[_equals(format, 'rgb')]]" restamp>
            <label>r:</label>
            <integer-input required="[[required]]" title="red" value="{{r}}" min="0" max="255" minlength="3"></integer-input>
            <label>g:</label>
            <integer-input required="[[required]]" title="green" value="{{g}}" min="0" max="255" minlength="3"></integer-input>
            <label>b:</label>
            <integer-input required="[[required]]" title="blue" value="{{b}}" min="0" max="255" minlength="3"></integer-input>
            <label>a:</label>
            <number-input required="[[required]]" title="alpha" value="{{alpha}}" default="1" min="0" max="1" saturate no-clamp placeholder="1.00" step="0.01" minlength="3.5"></number-input>
          </template>
          <template is="dom-if" if="[[_equals(format, 'hsl')]]" restamp>
            <label>h:</label>
            <number-input required="[[required]]" title="hue" placeholder="0" min="0" max="359" minlength="3" step="[[_hslStep]]" value="{{h}}"></number-input>
            <label>s:</label>
            <number-input required="[[required]]" title="saturation" placeholder="100\u202F%" minlength="2.5" in-percent saturate min="0" max="1" step="[[_hslPercentStep]]" start-at="1" value="{{s}}"></number-input>
            <label>l:</label>
            <number-input required="[[required]]" title="lightness" placeholder="100\u202F%" minlength="2.5" in-percent saturate min="0" max="1" step="[[_hslPercentStep]]" start-at="0.5" value="{{l}}"></number-input>
            <label>a:</label>
            <number-input required="[[required]]" title="alpha" value="{{alpha}}" default="1" min="0" max="1" saturate no-clamp step="0.01" placeholder="1.00" start-at="1" minlength="3.5"></number-input>
          </template>
        </div>
      `
    }

    static get properties() {
      return {

        _hexPatternString: {
          type: String,
          computed: '_computeHexPatternString(_validateHex)'
        },

        _hslStep: {
          type: Number,
          computed: '_computeHslStep(hslPrecision)'
        },

        _hslPercentStep: {
          type: Number,
          computed: '_computeHslPercentStep(hslPrecision)'
        }
      }
    }

    _equals(a, b) {
      return a === b;
    }

    _computeHexPatternString(_validateHex) {
      return _validateHex.toString().slice(1,-1);
    }

    _computeHslStep(hslPrecision) {
      return Math.pow(10, -hslPrecision);
    }

    _computeHslPercentStep(hslPrecision) {
      return Math.pow(10, -(hslPrecision + 2));
    }

  }
</script>

<dom-module id="color-input">
  <script>
  /**
  * `<color-input>` adds a color input to your page using Polymer.
  *
  *   ```html
  *     <color-input value="{{color}}"></color-input>
  *   ```
  *
  *
  * The following custom properties and mixins are also available for styling:
  *
  * Custom property | Description | Default
  * ----------------|-------------|----------
  * Custom property | Description | Default
  * ----------------|-------------|----------
  * `--transparency-pattern` | background pattern for the transparency layer | { background-image: linear-gradient(45deg, #000 25%, transparent 25%, transparent 75%, #000 75%, #000), linear-gradient(45deg, #000 25%, transparent 25%, transparent 75%, #000 75%, #000); background-size: 16px 16px; background-position:0 0, 8px 8px; opacity: .1; }
  * `--color-badge-border-radius` | border-radius of the badge | 0px
  *
  * @customElement
  * @polymer
  *
  * @appliesMixin ColorInputPattern
  *
  * @demo demo/input.html
  * @demo demo/form.html in a form
  **/
    class ColorInput extends ColorInputPattern(Polymer.Element) { // eslint-disable-line no-undef

      static get is() {
        return 'color-input';
      }

    }
    window.customElements.define(ColorInput.is, ColorInput);
  </script>
</dom-module>
